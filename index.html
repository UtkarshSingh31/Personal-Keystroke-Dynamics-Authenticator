<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Typing Behavior Collector</title>
  <style>
    body { font-family: Arial; padding: 30px; }
    textarea { width: 100%; height: 120px; font-size: 18px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    pre { background: #f4f4f4; padding: 10px; }
  </style>
</head>
<body>

<h2>Type the sentence</h2>
<textarea id="box" placeholder="Type here..."></textarea>
<br>
<button onclick="submitData()">Submit</button>

<h3>Text typed</h3>
<pre id="out"></pre>

<script>
const SERVER_URL = "https://YOUR-RENDER-APP.onrender.com/submit";

const userId = Number(prompt("Enter your user id:"));

let keyDownTime = {};
let sequence = [];
let lastRelease = null;
let typedText = "";

const box = document.getElementById("box");
const out = document.getElementById("out");

box.addEventListener("keydown", e => {
  keyDownTime[e.code] = performance.now();
});

box.addEventListener("keyup", e => {
  const now = performance.now();
  const press = keyDownTime[e.code];
  if (!press) return;

  const hold = (now - press) / 1000;
  const flight = lastRelease === null ? 0 : (press - lastRelease) / 1000;
  lastRelease = now;

  if (e.key === "Backspace") {
    typedText = typedText.slice(0, -1);
  } else if (e.key.length === 1) {
    typedText += e.key;
  } else if (e.key === " ") {
    typedText += " ";
  } else if (e.key === "Enter") {
    typedText += "\n";
  }

  out.textContent = typedText;

  sequence.push({
    key: e.key,
    hold_time: Number(hold.toFixed(4)),
    flight_time: Number(flight.toFixed(4))
  });

  delete keyDownTime[e.code];
});

function submitData() {
  fetch(SERVER_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      user_id: userId,
      sequence: sequence,
      text_typed: typedText
    })
  })
  .then(r => r.json())
  .then(d => {
    alert("Saved. Label = " + d.label);
    sequence = [];
    typedText = "";
    out.textContent = "";
    box.value = "";
  })
  .catch(err => alert("Error: " + err));
}
</script>

</body>
</html>
