<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Typing Behaviour Collection</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #faf9f6;
      --card: #ffffff;
      --text: #111111;
      --muted: #555555;
      --border: #dddddd;
      --accent: #000000;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      padding: 40px 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    h2 {
      font-size: 22px;
      margin-top: 30px;
      margin-bottom: 10px;
    }

    p {
      margin: 8px 0;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .warning {
      font-weight: 600;
      color: #000;
      margin-top: 6px;
    }

    textarea {
      width: 100%;
      min-height: 180px;
      resize: vertical;
      font-size: 16px;
      padding: 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-family: system-ui, monospace;
    }

    textarea:focus {
      outline: none;
      border-color: #000;
    }

    select {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-top: 10px;
    }

    .prompt-box {
      margin-top: 10px;
      padding: 12px;
      background: #f3f3f3;
      border-left: 4px solid #000;
      border-radius: 6px;
      font-size: 14px;
      white-space: pre-wrap;
    }

    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
    }

    button {
      background: #000;
      color: #fff;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    .status {
      color: var(--muted);
      font-size: 14px;
    }

    .preview {
      margin-top: 16px;
      padding: 12px;
      background: #f7f7f7;
      border: 1px solid var(--border);
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: monospace;
      color: #222;
    }
  </style>
</head>

<body>
<div class="container">

  <h1>Typing Behaviour Data Collection</h1>
  <p>
    This study records <b>how you type</b> (timing and rhythm), not the meaning of what you write.
  </p>

  <div class="card">
    <h2>Step 3: Type below</h2>

    <p class="warning">
      Please write at your <b>normal typing speed</b> for about <b>1â€“3 minutes</b>.
    </p>

    <!-- âœ… NEW: Question selector -->
    <label><b>Optional: Choose a question to write about</b></label>
    <select id="questionSelect">
      <option value="">-- Select a question (optional) --</option>
      <option>Tell me about yourself.</option>
      <option>Describe a challenging problem you solved.</option>
      <option>What are your strengths and weaknesses?</option>
      <option>Why did you choose your field of study?</option>
      <option>Explain a project you are proud of.</option>
      <option>Where do you see yourself in 5 years?</option>
      <option>Describe a failure and what you learned.</option>
      <option>How do you handle pressure or deadlines?</option>
      <option>What motivates you to learn new things?</option>
      <option>Explain a technical concept you understand well.</option>
      <option>What is a recent thing you learned?</option>
      <option>Why should someone hire you?</option>
    </select>

    <div class="prompt-box" id="selectedPrompt" style="display:none;"></div>

    <p class="status" id="timer">Time elapsed: 0:00</p>

    <textarea id="box" placeholder="Start typing here..."></textarea>

    <div class="row">
      <button onclick="submitData()">Submit</button>
      <div class="status" id="status">Typing data is being recordedâ€¦</div>
    </div>

    <h2 style="margin-top: 24px;">Live text preview</h2>
    <div class="preview" id="preview"></div>
  </div>

</div>

<script>
  const questionSelect = document.getElementById("questionSelect");
  const selectedPrompt = document.getElementById("selectedPrompt");

  questionSelect.addEventListener("change", () => {
    if (!questionSelect.value) {
      selectedPrompt.style.display = "none";
      selectedPrompt.textContent = "";
      return;
    }
    selectedPrompt.style.display = "block";
    selectedPrompt.textContent =
      "Selected question:\n" +
      questionSelect.value +
      "\n\nWrite your answer in your own words below.";
  });
</script>

<!-- ðŸ”½ YOUR ORIGINAL SCRIPT (UNCHANGED) ðŸ”½ -->
<script>
  const SERVER_URL = "https://typing-behavior-server-a6ka.onrender.com/submit";
  const userId = Number(prompt("Enter your user ID (same as earlier):"));

  let keyDownTime = {};
  let sequence = [];
  let lastRelease = null;
  let typedText = "";

  let startTime = null;
  let timerInterval = null;

  const box = document.getElementById("box");
  const preview = document.getElementById("preview");
  const status = document.getElementById("status");

  function startTimer() {
    if (timerInterval) return;

    startTime = performance.now();
    timerInterval = setInterval(() => {
      const elapsedMs = performance.now() - startTime;
      const seconds = Math.floor(elapsedMs / 1000);
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;

      document.getElementById("timer").textContent =
        `Time elapsed: ${mins}:${secs.toString().padStart(2, "0")}`;
    }, 500);
  }

  box.addEventListener("keydown", e => {
    startTimer();
    keyDownTime[e.code] = performance.now();
  });

  box.addEventListener("keyup", e => {
    const press = keyDownTime[e.code];
    if (!press) return;

    const now = performance.now();
    const hold = (now - press) / 1000;
    const flight = lastRelease === null ? 0 : (press - lastRelease) / 1000;
    lastRelease = now;

    if (e.key === "Backspace") typedText = typedText.slice(0, -1);
    else if (e.key.length === 1) typedText += e.key;
    else if (e.key === "Enter") typedText += "\n";

    preview.textContent = typedText;

    sequence.push({
      key: e.key,
      hold_time: Number(hold.toFixed(4)),
      flight_time: Number(flight.toFixed(4))
    });

    delete keyDownTime[e.code];
  });

  function submitData() {
    if (sequence.length < 10) {
      alert("Please type a bit more before submitting.");
      return;
    }

    status.textContent = "Submittingâ€¦";

    fetch(SERVER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        user_id: userId,
        sequence: sequence,
        text_typed: typedText
      })
    })
    .then(res => res.json())
    .then(() => {
      status.textContent = "Data submitted successfully.";
      box.value = "";
      preview.textContent = "";
      typedText = "";
      sequence = [];
      lastRelease = null;

      clearInterval(timerInterval);
      timerInterval = null;
      startTime = null;
      document.getElementById("timer").textContent = "Time elapsed: 0:00";
    })
    .catch(() => {
      status.textContent = "Submission failed. Please try again.";
    });
  }
</script>

</body>
</html>